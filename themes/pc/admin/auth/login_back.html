<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title><?= config("app_title");?></title>
    {CSS href="__STATIC__/css/admin/admin_base.css" /}
    {css href="__STATIC__/libs/layui/css/layui.css" /}
    {js href="__STATIC__/libs/jquery/jquery-2.1.4.js" /}
    {js href='__STATIC__/libs/layui/layui.js' /}
</head>
<body class="login_body">
<div id="login_wrapper">
    <div class="rha_login">
        <div class="mod-body ">
            <div class="content">
                <h2><?= config("app_title");?></h2>
                <form class="layui-form" id="loginform">
                    <ul>
                        <li>
                            <input name="user_name" lay-verify="required" placeholder="请输入登录用户名" type="text"
                                   autocomplete="off" class="layui-input">
                        </li>
                        <li>
                            <input name="password" lay-verify="required" placeholder="请输入登录密码" type="password"
                                   autocomplete="off" class="layui-input">
                        </li>
                        <li>
                            <div class="layui-row">
                                <div class="layui-col-md5">
                                    <input name="verify" lay-verify="required" placeholder="请输入验证码" type="text"
                                           autocomplete="off" class="layui-input">
                                </div>
                                <div class="layui-col-md6" style="padding-left: 10px;">
                                    <img id="code-img" src="{:url('verify')}" onclick="this.src='{:url('verify')}?'+Math.random();">
                                </div>
                            </div>
                        </li>
                        <li class="alert alert-danger collapse error_message">
                            <i class="icon icon-delete"></i> <em></em>
                        </li>
                        <li class="last">
                            <div class="layui-input-inline login-btn">
                                <button type="submit" lay-submit="" lay-filter="login" class="layui-btn">登录</button>
                            </div>
                        </li>
                    </ul>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="footer" style="position: fixed;bottom: 0;left: 0;right: 0;">
    <div class="wrap">
        <!--请遵守安装使用协议，未经允许不得删除或者屏蔽有关RhaPHP字样-->
        Powered By KyPHP <?= config("app_name");?> Copyright © {:date('Y')} All Rights Reserved.
    </div>
</div>

<script>

    layui.use('form', function () {
        (function () {
            var isIE = function () {
                var U = navigator.userAgent,
                    IsIE = U.indexOf('MSIE') > -1,
                    a = IsIE ? /\d+/.exec(U.split(';')[1]) : 'no ie';
                return a <= 8;
            }();
            if (isIE) {
                layer.alert('你的浏览器内核版本过低,若有极速模式请选择使用极速模式或者使用谷歌、火狐浏览器。');
            }
        })();

        var form = layui.form;
        form.on('submit(login)', function (data) {
            $.post(
                "{:url('login')}",
                data.field,
                function (res) {
                    if (res.code == 1) {
                        layer.msg(res.msg, {icon: 1, time: 2000}, function () {
                            location.href = res.url;
                        });
                    } else {
                        document.getElementById("code-img").src = "{:url('verify')}" + "?v=" + (new Date).getDate();
                        layer.alert(res.msg);
                    }
                }, "json"
            );
            return false;
        });
    });
</script>
</body>
</html>
